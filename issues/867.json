{
  "type": "issue",
  "issue": {
    "id": 3009926558,
    "node_id": "I_kwDOEEET9c6zZ9We",
    "url": "https://api.github.com/repos/bitcoin-core/gui/issues/867",
    "repository_url": "https://api.github.com/repos/bitcoin-core/gui",
    "labels_url": "https://api.github.com/repos/bitcoin-core/gui/issues/867/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin-core/gui/issues/867/comments",
    "events_url": "https://api.github.com/repos/bitcoin-core/gui/issues/867/events",
    "html_url": "https://github.com/bitcoin-core/gui/issues/867",
    "number": 867,
    "state": "open",
    "state_reason": null,
    "title": "PIE+LTO causes Bitcoin-Qt to segfault at startup",
    "body": "### Issues, reports or feature requests related to the GUI should be opened directly on the GUI repo\n\n- [x] I still think this issue should be opened here\n\n### Report\n\nWhen PIE and LTO are combined, Qt applications crash at startup. See [Gentoo bug 954171](https://bugs.gentoo.org/954171). You can read all the gorey details about the underlying issue (that also affected Wireshark) [here](https://bugs.gentoo.org/754021). Basically, the issue is that Qt's `qcompilerdetection.h` prohibits building Qt with PIE because PIE breaks a critical assumption that Qt makes, but when a Qt application is built using LTO, the application's `-fPIE` flag overrides Qt's `-fPIC` flag and causes pieces of Qt to be optimized under the PIE model, which breaks it and causes it to segfault at runtime. The guard in `qcompilerdetection.h` is powerless to detect and prevent this because it's implemented by a preprocessor directive, and the preprocessor is not involved during LTO. To fix this, Bitcoin-Qt has to choose either LTO or PIE but not both. In Gentoo we plan to work around this for now by filtering out `-flto` from the user's flags, but it would be nicer to have an upstream solution.",
    "user": {
      "login": "whitslack",
      "id": 797782,
      "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/whitslack",
      "html_url": "https://github.com/whitslack",
      "followers_url": "https://api.github.com/users/whitslack/followers",
      "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
      "organizations_url": "https://api.github.com/users/whitslack/orgs",
      "repos_url": "https://api.github.com/users/whitslack/repos",
      "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/whitslack/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 1,
    "created_at": "2025-04-22T05:34:16Z",
    "updated_at": "2025-04-22T05:56:21Z"
  },
  "events": [
    {
      "event": "subscribed",
      "id": 17347137226,
      "node_id": "SE_lADOEEET9c6zZ9WezwAAAAQJ-E7K",
      "url": "https://api.github.com/repos/bitcoin-core/gui/issues/events/17347137226",
      "actor": {
        "login": "thesamesam",
        "id": 11667869,
        "node_id": "MDQ6VXNlcjExNjY3ODY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/11667869?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/thesamesam",
        "html_url": "https://github.com/thesamesam",
        "followers_url": "https://api.github.com/users/thesamesam/followers",
        "following_url": "https://api.github.com/users/thesamesam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/thesamesam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/thesamesam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/thesamesam/subscriptions",
        "organizations_url": "https://api.github.com/users/thesamesam/orgs",
        "repos_url": "https://api.github.com/users/thesamesam/repos",
        "events_url": "https://api.github.com/users/thesamesam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/thesamesam/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-22T05:35:52Z"
    },
    {
      "event": "commented",
      "id": 2820150044,
      "node_id": "IC_kwDOEEET9c6oGBMc",
      "url": "https://api.github.com/repos/bitcoin-core/gui/issues/comments/2820150044",
      "actor": {
        "login": "eli-schwartz",
        "id": 6551424,
        "node_id": "MDQ6VXNlcjY1NTE0MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6551424?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eli-schwartz",
        "html_url": "https://github.com/eli-schwartz",
        "followers_url": "https://api.github.com/users/eli-schwartz/followers",
        "following_url": "https://api.github.com/users/eli-schwartz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eli-schwartz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eli-schwartz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eli-schwartz/subscriptions",
        "organizations_url": "https://api.github.com/users/eli-schwartz/orgs",
        "repos_url": "https://api.github.com/users/eli-schwartz/repos",
        "events_url": "https://api.github.com/users/eli-schwartz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eli-schwartz/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-22T05:56:20Z",
      "updated_at": "2025-04-22T05:56:20Z",
      "author_association": "NONE",
      "body": "To be clear, the actual issue is that cmake has POSITION_INDEPENDENT_CODE, which claims to implement PIC, but it does not. It enables PIE instead, which is not what you actually asked for, and they are unfortunately different enough to matter.\n\nIt's quite fine to enforce -fPIC (and also to link with -pie), but cmake simply does not provide the necessary builtin functionality to do it correctly.",
      "user": {
        "login": "eli-schwartz",
        "id": 6551424,
        "node_id": "MDQ6VXNlcjY1NTE0MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6551424?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eli-schwartz",
        "html_url": "https://github.com/eli-schwartz",
        "followers_url": "https://api.github.com/users/eli-schwartz/followers",
        "following_url": "https://api.github.com/users/eli-schwartz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eli-schwartz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eli-schwartz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eli-schwartz/subscriptions",
        "organizations_url": "https://api.github.com/users/eli-schwartz/orgs",
        "repos_url": "https://api.github.com/users/eli-schwartz/repos",
        "events_url": "https://api.github.com/users/eli-schwartz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eli-schwartz/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin-core/gui/issues/867#issuecomment-2820150044",
      "issue_url": "https://api.github.com/repos/bitcoin-core/gui/issues/867"
    }
  ]
}